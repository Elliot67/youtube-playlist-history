name: "Auto save playlist"

on:
  workflow_dispatch:
  schedule:
  - cron: "0 0 * * 1"

jobs:
  execute:
    runs-on: ubuntu-latest
    steps:

      - name: Download youtube-dl
        run : |
          sudo apt update
          sudo curl -L https://yt-dl.org/downloads/latest/youtube-dl -o /usr/local/bin/youtube-dl
          sudo chmod a+rx /usr/local/bin/youtube-dl
          sudo youtube-dl --update
          sudo apt install jq

      - name: Clone repo
        uses: actions/checkout@v2

      - name: Generate file
        run: |
          youtube-dl --dump-json --flat-playlist --no-warnings --ignore-errors --geo-bypass https://www.youtube.com/playlist?list=${{ secrets.PLAYLIST_ID }} | jq --raw-output '"\(.id) | \(.uploader) | \(.title)"' > playlist.txt

      - name: Setup git config
        run: |
          git config user.name "GitHub Actions Bot"
          git config user.email "<>"

      - name: Commit the file
        run: |
          git add playlist.txt
          git commit --allow-empty -m "ðŸ¤– update playlist tracks list"
          git push origin main
